$(document).ready(function(){
    "use strict";

$(".form-container").css("visibility", "hidden !important");
$(".pseudo-div").hide();

//Open Modal on button click
$(".open-modal").click(function(e){
    $(".form-container").fadeIn(500);
    $(".probootstrap-header").css("opacity","0.6");
    $("footer").css("opacity","0.6");
    $("section").css("opacity","0.6");
    $(".pseudo-div").fadeIn(400);
});

//close modal on outside modal
$(".pseudo-div").click(function(){
    $(".probootstrap-header").css("opacity","1");
    $("footer").css("opacity","1");
    $("section").css("opacity","1");
    $(".pseudo-div").fadeOut(400);
    $(".form-container").fadeOut(200);
})

$(".clos").click(function(){
    $(".probootstrap-header").css("opacity","1");
    $("footer").css("opacity","1");
    $("section").css("opacity","1");
    $(".pseudo-div").fadeOut(400);
    $(".form-container").fadeOut(200);
})
var qone= $(" .qone");
var qtwo= $(" .qtwo");
var qthree= $(" .qthree");
var qfour= $(" .qfour");
var qfive= $(" .qfive");
var qsix= $(" .qsix");
var qseven= $(" .qseven");
var qeight= $(" .qeight");
var result= $(" .result");

//Hiding all other questions other than first

qtwo.hide();
qthree.hide();
qfour.hide();
qfive.hide();
qsix.hide();
qseven.hide();
qeight.hide();
result.hide();

var a = {0:"",1:"one",2:"two",3:"three",4:"four",5:"five",6:"six",7:"seven",8:"eight"}
var b = {"":0,"one":1,"two":2,"three":3,"four":4,"five":5,"six":6,"seven":7,"eight":8}

var c,d,m;
$(".back").click(function(e){
    e.preventDefault()
    m=this.parentElement.parentElement.getAttribute("class")
    c=m.split("q")
    c=c[1]
    for (var s in a){
    if (a[s]==c){
        d=a[s-1]
    }
    }
    var qprev=".q"+d.toString();
    m="."+m
    console.log(m)
    console.log(d)
    console.log(qprev)
    $(m).fadeOut(300,function(){
        $(qprev).fadeIn(300)
    })
})
//Next button clicks action
$(".qone .next").click(function(e){
    e.preventDefault();
    if ($("#sgt").val()==""){
        alert("Please enter a value!")
    }
    else{
    qone.fadeOut(300, function(){
        qtwo.fadeIn(300);
    });
    }
});

$(".qtwo .next").click(function(e){
    e.preventDefault();
    if ($("#alt").val()==""){
        alert("Please enter a value!")
    }
    else{
    qtwo.fadeOut(300, function(){
        qthree.fadeIn(300);
    });
    }

});
$(".qthree .next").click(function(e){
    e.preventDefault();
    if ($("#sct").val()==""){
        alert("Please enter a value")
    }
    else{
    qthree.fadeOut(300, function(){
        qfour.fadeIn(300);
    });
    }

});
$(".qfour .next").click(function(e){
    e.preventDefault();
    if ($("#hemot").val()==""){
        alert("Please enter a value")
    }
    else{
    qfour.fadeOut(300, function(){
        qfive.fadeIn(300);
    });
    }
});
$(".qfive .next").click(function(e){
    e.preventDefault();
    if ($("#pcvt").val()==""){
        alert("Please enter a value")
    }
    else{
    qfive.fadeOut(300, function(){
        qsix.fadeIn(300);
    });
    }
});
$(".qsix .next").click(function(e){
    e.preventDefault();
    if ($("#wct").val()==""){
        alert("Please enter a value")
    }
    else{
    qsix.fadeOut(300, function(){
        qseven.fadeIn(300);
    });
    }
});
$(".qseven .next").click(function(e){
    e.preventDefault();
    if ($("#rct").val()==""){
        alert("Please enter a value")
    }
    else{
    qseven.fadeOut(300, function(){
        qeight.fadeIn(300);
    });
    }
});
$(".qeight .finish").click(function(e){
    e.preventDefault();
    if ($("#htnt").val()==""){
        alert("Please enter a value")
    }
    else{
    qeight.fadeOut(300, function(){
        result.fadeIn(300);
    });
    //XMLHTTP request to server for Machine Learning Prediction
    prediction()
    }
});
});

function prediction(){
    // Getting data for prediction
    var sgt=document.getElementById("sgt").value;
    var alt=document.getElementById("alt").value;
    var sct=document.getElementById("sct").value;
    var hemot=document.getElementById("hemot").value;
    var pcvt=document.getElementById("pcvt").value;
    var wct=document.getElementById("wct").value;
    var rct=document.getElementById("rct").value;
    var htnt=document.getElementById("htnt").value;
    // Getting info about User
    var brwsr = navigator.appName + navigator.appVersion;
    var locatn = 'unknown' ;
    var os = navigator.platform ;
    var cpu = navigator.hardwareConcurrency;
    var ip = 'unknown';
    // Logging data submitted into our database
    db.collection("classify-request").add({
    sg: sgt,
    al:alt,
	sc: sct,
	hemo: hemot,
	pcv: pcvt,
	wc: wct,
	rc: rct,
    htn: htnt,
    ip:ip,
    brwsr:brwsr,
    cpu_core:cpu,
    os: os,
    locatn:locatn,
    time: new Date()
    })
    // Request starts
    var newurl="https://now-express.intru-innovation.now.sh/clsazure"+"?sg="+sgt+"&al=" +alt+"&sc="+sct+"&hemo="+hemot+"&pcv="+pcvt+"&wc="+wct+"&rc="+rct+"&htn="+htnt+"&brwsr="+brwsr+"&os="+os+"&locatn="+locatn+"&cpu="+cpu+"&ip="+ip;
    var xhttp = new XMLHttpRequest();
    var resdiv=$(".result");
    xhttp.onreadystatechange = function() {
     var causelink= document.querySelector(".causelink");
     if (this.readyState == 4 && this.status == 200) {
      if (this.responseText.includes("notckd")){
            $(".result").html("<br/>Congrats, You are SAFE! <br/> Based on the data you provided our AI Systems could <b>not find a possibility for Chronic Kidney Disease</b><br/>");
        }
        else{
            resdiv.html("<br/>You are in DANGER ! <br/> Based on the data you provided our AI Systems did figure out a <b>possibility of Chronic Kidney Disease</b>. Please go and see out a specialised physician!<br/><br/>\
            <br/><a href='cause' class='causelink btn btn-danger'>FIND OUT THE CAUSE</button>")
            $(".report").show();
        }
        }
        }
        
      xhttp.open("GET", newurl, true);
      xhttp.send();
}